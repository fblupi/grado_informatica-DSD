/*
 * This is sample code generated by rpcgen.
 * These are only templates and you can use them
 * as a guideline for developing your own functions.
 */

#include "asociacion.h"

typedef enum {false,true} bool;

DiccionarioPtr root = NULL;

Estado *
ponerasociacion_1_svc(ID arg1, Clave arg2, Valor arg3,  struct svc_req *rqstp)
{
	printf("\nINSERCION:\n");
	//printf("id: %d\n", arg1);
	//printf("clave: %s\n", arg2);
	//printf("valor: %s\n", arg3);

	static Estado  result;

	if(root==NULL) { // No hay ningún diccionario
		printf("No hay ningun diccionario\n");
		// Nueva entrada
		EntradaPtr ent = (EntradaPtr)malloc(sizeof(Entrada));
		ent->clave = strdup(arg2);
		ent->valor = strdup(arg3);
		ent->sig = NULL;
		//printf("\tEntrada:\n");
		//printf("\t\tclave: %s\n",ent->clave);
		//printf("\t\tvalor: %s\n",ent->valor);
		// Nuevo diccionario
		DiccionarioPtr dic = (DiccionarioPtr)malloc(sizeof(Diccionario));  
		dic->id = arg1;
		dic->sig = NULL;
		dic->first = ent;
		root = dic;
		result = OK;
	} else { // Hay algún diccionario
		printf("Hay algun diccionario\n");
		DiccionarioPtr dicPtr = root;
		bool encontradoID = false;
		if(dicPtr->id==arg1) {
			encontradoID = true;
		}
		while(encontradoID==false && dicPtr->sig!=NULL) { // Buscar diccionario
			dicPtr=dicPtr->sig;
			if(dicPtr->id==arg1) {
				encontradoID = true;
			}
		}
		if(encontradoID==true) { // Diccionario encontrado
			printf("Diccionario encontrado\n");
			EntradaPtr entPtr = dicPtr->first;
			//printf("\tEntrada:\n");
			//printf("\t\tclave: %s\n", entPtr->clave);
			//printf("\t\tvalor: %s\n", entPtr->valor);
			bool encontradoClave = false;
			if(strcmp(entPtr->clave,arg2)==0) {
				encontradoClave = true;
			}
			while(encontradoClave==false && entPtr->sig!=NULL) { // Buscar entrada
				entPtr = entPtr->sig;
				if(strcmp(entPtr->clave,arg2)==0) {
					encontradoClave = true;
				}
			}
			if(encontradoClave==true) { // Clave encontrada
				printf("Clave encontrada\n");
				entPtr->valor = strdup(arg3);
				result = REEMPLAZADO;
			} else { //  Clave no encontrada
				printf("Clave no encontrada\n");
				// Nueva entrada
				EntradaPtr ent = (EntradaPtr)malloc(sizeof(Entrada));
				ent->clave = strdup(arg2);
				ent->valor = strdup(arg3);
				ent->sig = NULL;
				entPtr->sig = ent;
				result = OK;
			}
		} else { // Diccionario no encontrado -> se crea uno nuevo
			printf("Diccionario no encontrado\n");
			// Nueva entrada
			EntradaPtr ent = (EntradaPtr)malloc(sizeof(Entrada));
			ent->clave = strdup(arg2);
			ent->valor = strdup(arg3);
			ent->sig = NULL;
			// Nuevo diccionario
			DiccionarioPtr dic = (DiccionarioPtr)malloc(sizeof(Diccionario));  
			dic->id = arg1;
			dic->sig = NULL;
			dic->first = ent;
			dicPtr->sig = dic;
			result = OK;
		}
	}

	switch(result) {
		case OK: printf("OK\n"); break;
		case REEMPLAZADO: printf("REEMPLAZADO\n"); break;
		case FALLO: printf("FALLO\n"); break;
		default: break;
	}

	return &result;
}

ResultEntrada *
obtenerasociacion_1_svc(ID arg1, Clave arg2,  struct svc_req *rqstp)
{
	printf("\nCONSULTA:\n");

	static ResultEntrada  result;

	if(root==NULL) { // No hay ningún diccionario
		printf("No hay ningun diccionario\n");
		result.e = FALLO;
	} else { // Hay algún diccionario
		printf("Hay algun diccionario\n");
		DiccionarioPtr dicPtr = root;
		bool encontradoID = false;
		if(dicPtr->id==arg1) {
			encontradoID = true;
		}
		while(encontradoID==false && dicPtr->sig!=NULL) { // Buscar diccionario
			dicPtr=dicPtr->sig;
			if(dicPtr->id==arg1) {
				encontradoID = true;
			}
		}
		if(encontradoID==true) { // Diccionario encontrado
			printf("Diccionario encontrado\n");
			EntradaPtr entPtr = dicPtr->first;
			bool encontradoClave = false;
			if(strcmp(entPtr->clave,arg2)==0) {
				encontradoClave = true;
			}
			while(encontradoClave==false && entPtr->sig!=NULL) { // Buscar entrada
				entPtr = entPtr->sig;
				if(strcmp(entPtr->clave,arg2)==0) {
					encontradoClave = true;
				}
			}
			if(encontradoClave==true) { // Clave encontrada
				printf("Clave encontrada\n");
				result.e = OK;
				result.ResultEntrada_u.valor = strdup(entPtr->valor);
			} else { //  Clave no encontrada
				printf("Clave no encontrada\n");
				// Nueva entrada
				result.e = FALLO;
			}
		} else { // Diccionario no encontrado -> se crea uno nuevo
			printf("Diccionario no encontrado\n");
			result.e = FALLO;
		}
	}

	return &result;
}

Estado *
borrarasociacion_1_svc(ID arg1, Clave arg2,  struct svc_req *rqstp)
{
	static Estado  result;

/*******************************************************************************
BORRAR
********************************************************************************

 

*******************************************************************************/

	return &result;
}

ResultDiccionario *
enumerar_1_svc(ID arg1,  struct svc_req *rqstp)
{
	static ResultDiccionario  result;

/*******************************************************************************
ENUMERAR
********************************************************************************

encontradoID = BUSCAR ID;
if(encontradoID) {
	result->entrada = diccinarioPtr->first;
	result->e = OK;
} else {	
	result->e = FALLO;
}
	 
*******************************************************************************/

	return &result;
}
